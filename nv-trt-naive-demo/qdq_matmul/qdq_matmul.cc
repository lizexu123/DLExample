#include "/usr/local/tensorrt/include/NvInfer.h"
#include <vector>
#include <iostream>
#include <stdio.h>
#include <cstring>

// g++ qdq_matmul.cc -lnvinfer -lcudart  -L /usr/local/tensorrt/lib/ -L/usr/local/cuda/lib64 -I /usr/local/cuda/include
// export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/usr/local/tensorrt/lib


#define TRT_VERSION                                    \
  NV_TENSORRT_MAJOR * 1000 + NV_TENSORRT_MINOR * 100 + \
      NV_TENSORRT_PATCH * 10 + NV_TENSORRT_BUILD

#include "/usr/local/cuda/include/cuda_runtime.h"
class TensorrtLogger : public nvinfer1::ILogger {
  nvinfer1::ILogger::Severity verbosity_;

 public:
  TensorrtLogger(Severity verbosity = Severity::kWARNING)
      : verbosity_(verbosity) {}
  void log(Severity severity, const char* msg) noexcept override {
    if (severity <= verbosity_) {
        printf("%s\n", msg);
  }
  }
};

int main()
{
    std::cout << TRT_VERSION  << std::endl;
    static TensorrtLogger trt_logger(nvinfer1::ILogger::Severity::kWARNING);
    auto trt_builder = nvinfer1::createInferBuilder(trt_logger);
    const auto explicitBatch = 1U << static_cast<uint32_t>(nvinfer1::NetworkDefinitionCreationFlag::kEXPLICIT_BATCH);
    auto trt_network = trt_builder->createNetworkV2(explicitBatch);
    auto trt_config = trt_builder->createBuilderConfig();
    trt_config->setFlag(nvinfer1::BuilderFlag::kINT8);
    trt_config->setMaxWorkspaceSize(1<<30);

    nvinfer1::Dims input0_dims;
    input0_dims.nbDims = 2;
    input0_dims.d[0] = -1;
    input0_dims.d[1] = 1280;


    trt_network->addInput("foo0", nvinfer1::DataType::kFLOAT, input0_dims);

    int m = 1280;
    int n = 1280;
    float* weight_ptr = new float[m * n];
    memset(weight_ptr, 0, sizeof(float) * m * n);

  nvinfer1::Weights kernel_weight;
  kernel_weight.type = nvinfer1::DataType::kFLOAT;
  kernel_weight.values = static_cast<void*>(weight_ptr);
  kernel_weight.count = m * n;
  nvinfer1::Dims kernel_dims;
  kernel_dims.nbDims = 2;
  kernel_dims.d[0] = m;
  kernel_dims.d[1] = n;
  auto kernel_tensor = trt_network->addConstant(kernel_dims, kernel_weight)->getOutput(0);
  float kernel_scale[n] = {0.06467156857252121,
    0.042300995439291,
    0.049017004668712616,
    0.05665214732289314,
    0.06919552385807037,
    0.050821997225284576,
    0.0608421191573143,
    0.04095733165740967,
    0.04720531776547432,
    0.05589348450303078,
    0.061923157423734665,
    0.05712135136127472,
    0.04198865965008736,
    0.029614821076393127,
    0.03042490966618061,
    0.025447411462664604,
    0.033594563603401184,
    0.0978270098567009,
    0.040120743215084076,
    0.036620836704969406,
    0.05021510273218155,
    0.05236860737204552,
    0.029459137469530106,
    0.04785731062293053,
    0.04657673463225365,
    0.0359908789396286,
    0.06162623316049576,
    0.030450919643044472,
    0.05071443319320679,
    0.0298259686678648,
    0.043144240975379944,
    0.06345239281654358,
    0.06075480207800865,
    0.03699121251702309,
    0.04848219081759453,
    0.06773620843887329,
    0.03324783965945244,
    0.028809919953346252,
    0.04430152475833893,
    0.027444520965218544,
    0.11906477063894272,
    0.04012499377131462,
    0.041364673525094986,
    0.040457043796777725,
    0.03348001092672348,
    0.05065463110804558,
    0.035013411194086075,
    0.06247097998857498,
    0.04680415615439415,
    0.051023367792367935,
    0.04974786937236786,
    0.051662787795066833,
    0.030268222093582153,
    0.060225725173950195,
    0.040155135095119476,
    0.03601507097482681,
    0.037916310131549835,
    0.05062050744891167,
    0.03769340738654137,
    0.04948997497558594,
    0.022004203870892525,
    0.03197898715734482,
    0.03102901205420494,
    0.047223396599292755,
    0.04535561427474022,
    0.03240729868412018,
    0.035675909370183945,
    0.04557322338223457,
    0.052937258034944534,
    0.06369892507791519,
    0.05277176946401596,
    0.054709382355213165,
    0.04790036752820015,
    0.051424212753772736,
    0.06486561894416809,
    0.048932995647192,
    0.031527165323495865,
    0.05566151440143585,
    0.09027223289012909,
    0.03180453181266785,
    0.0437195859849453,
    0.036341022700071335,
    0.04419208690524101,
    0.03696786239743233,
    0.043056387454271317,
    0.038536254316568375,
    0.039204325526952744,
    0.03332199901342392,
    0.03432172164320946,
    0.03362492471933365,
    0.033275071531534195,
    0.05383092537522316,
    0.06588155776262283,
    0.039917632937431335,
    0.040167465806007385,
    0.037568092346191406,
    0.04329770430922508,
    0.04500095546245575,
    0.03616480901837349,
    0.05604931339621544,
    0.03404379263520241,
    0.0438038632273674,
    0.0340876579284668,
    0.04682011157274246,
    0.045322220772504807,
    0.033998191356658936,
    0.051212068647146225,
    0.0503726601600647,
    0.04154052212834358,
    0.036431148648262024,
    0.052183035761117935,
    0.08633419126272202,
    0.04647565260529518,
    0.0833355188369751,
    0.05097423866391182,
    0.01854126900434494,
    0.047210704535245895,
    0.04964681342244148,
    0.053798858076334,
    0.03617365285754204,
    0.038236841559410095,
    0.03794735297560692,
    0.05047092214226723,
    0.046498287469148636,
    0.03078722022473812,
    0.045295629650354385,
    0.03342064097523689,
    0.04076595604419708,
    0.09810436517000198,
    0.04348025098443031,
    0.059602852910757065,
    0.04091852530837059,
    0.04781335964798927,
    0.038229383528232574,
    0.041404180228710175,
    0.03374234214425087,
    0.02629949524998665,
    0.06690346449613571,
    0.03138023242354393,
    0.04046788066625595,
    0.048714011907577515,
    0.029949786141514778,
    0.03483118861913681,
    0.04682879149913788,
    0.04786461964249611,
    0.049765560775995255,
    0.032714903354644775,
    0.0519375242292881,
    0.04817163199186325,
    0.10365761816501617,
    0.03352712094783783,
    0.05601207911968231,
    0.04182245954871178,
    0.0324455127120018,
    0.05266183614730835,
    0.037673402577638626,
    0.04107440635561943,
    0.05204523727297783,
    0.03785546496510506,
    0.06529626250267029,
    0.04672320932149887,
    0.03750855475664139,
    0.04333879053592682,
    0.04812222346663475,
    0.040517088025808334,
    0.04228586331009865,
    0.04495662450790405,
    0.053422704339027405,
    0.04046506807208061,
    0.043124761432409286,
    0.060108352452516556,
    0.047439564019441605,
    0.0432874895632267,
    0.033168449997901917,
    0.03166835382580757,
    0.03599296882748604,
    0.05104710906744003,
    0.07538148015737534,
    0.06406805664300919,
    0.026706723496317863,
    0.031900886446237564,
    0.03519180044531822,
    0.05014470964670181,
    0.04818335548043251,
    0.0806690901517868,
    0.03484407067298889,
    0.04425748065114021,
    0.02919771894812584,
    0.03826940059661865,
    0.049419183284044266,
    0.04207636043429375,
    0.021201374009251595,
    0.07226159423589706,
    0.024146202951669693,
    0.047717053443193436,
    0.029186569154262543,
    0.06859420984983444,
    0.044906921684741974,
    0.04400049149990082,
    0.08535060286521912,
    0.034354619681835175,
    0.03523452579975128,
    0.028221020475029945,
    0.04682227596640587,
    0.05488857999444008,
    0.037782080471515656,
    0.03323712199926376,
    0.046083807945251465,
    0.04832100123167038,
    0.04649018496274948,
    0.06707734614610672,
    0.05056058242917061,
    0.04913680627942085,
    0.03539297357201576,
    0.06111735850572586,
    0.04882540926337242,
    0.045571692287921906,
    0.0693947896361351,
    0.05789932608604431,
    0.06607028841972351,
    0.05881570279598236,
    0.06398772448301315,
    0.061286211013793945,
    0.03836505487561226,
    0.050618384033441544,
    0.025737203657627106,
    0.03279513493180275,
    0.047590453177690506,
    0.04405871033668518,
    0.039697710424661636,
    0.034367721527814865,
    0.029171230271458626,
    0.045118968933820724,
    0.02950206585228443,
    0.06633701175451279,
    0.021051999181509018,
    0.04802939295768738,
    0.03283107653260231,
    0.032967716455459595,
    0.04277241602540016,
    0.04364100098609924,
    0.0314856693148613,
    0.035073138773441315,
    0.04165676236152649,
    0.046223171055316925,
    0.07767985761165619,
    0.04632307216525078,
    0.02894112467765808,
    0.06306840479373932,
    0.043774671852588654,
    0.047092996537685394,
    0.05584312230348587,
    0.046920448541641235,
    0.03974449262022972,
    0.04754605516791344,
    0.05237920209765434,
    0.03258010745048523,
    0.03163651376962662,
    0.03905906528234482,
    0.0595194436609745,
    0.05839203670620918,
    0.042447470128536224,
    0.06138188764452934,
    0.04732198268175125,
    0.05223766714334488,
    0.04889938607811928,
    0.04375462606549263,
    0.0692758560180664,
    0.04215331748127937,
    0.059614866971969604,
    0.04993842914700508,
    0.0539916530251503,
    0.05472375825047493,
    0.04218079149723053,
    0.058872662484645844,
    0.03869108483195305,
    0.041919223964214325,
    0.06195472180843353,
    0.04974300414323807,
    0.04425683245062828,
    0.05145779252052307,
    0.045216090977191925,
    0.04114503040909767,
    0.028956780210137367,
    0.04127579554915428,
    0.038202591240406036,
    0.026589371263980865,
    0.04578780755400658,
    0.04355142265558243,
    0.043497905135154724,
    0.029252242296934128,
    0.04353322461247444,
    0.03749096021056175,
    0.05860912799835205,
    0.05108078569173813,
    0.055493444204330444,
    0.047795962542295456,
    0.038683388382196426,
    0.03699518367648125,
    0.017422210425138474,
    0.07871349155902863,
    0.11152654141187668,
    0.029399817809462547,
    0.04620462656021118,
    0.05130400136113167,
    0.045811399817466736,
    0.029809173196554184,
    0.046600405126810074,
    0.03662143647670746,
    0.09631017595529556,
    0.04138613119721413,
    0.03787573426961899,
    0.03392300754785538,
    0.04140395298600197,
    0.10833026468753815,
    0.03978845849633217,
    0.045421093702316284,
    0.04678017646074295,
    0.05447506159543991,
    0.0391528457403183,
    0.03483216464519501,
    0.10566750913858414,
    0.03469054773449898,
    0.0369282066822052,
    0.0591454841196537,
    0.04676363244652748,
    0.029687980189919472,
    0.0234820656478405,
    0.06221836060285568,
    0.038566023111343384,
    0.047219909727573395,
    0.030726099386811256,
    0.04418877139687538,
    0.05098545923829079,
    0.04977491497993469,
    0.058457814157009125,
    0.031374361366033554,
    0.03431400656700134,
    0.04436001181602478,
    0.03999202698469162,
    0.05392405018210411,
    0.0410766638815403,
    0.050408221781253815,
    0.03421919792890549,
    0.0429280549287796,
    0.03360634669661522,
    0.028842436149716377,
    0.06826283037662506,
    0.03349226340651512,
    0.037216588854789734,
    0.025026960298419,
    0.12418495863676071,
    0.024182137101888657,
    0.060514338314533234,
    0.050768088549375534,
    0.048550140112638474,
    0.024427663534879684,
    0.09121526777744293,
    0.04251283407211304,
    0.04928295686841011,
    0.03919210284948349,
    0.052754923701286316,
    0.05258714780211449,
    0.044617027044296265,
    0.024547506123781204,
    0.053936731070280075,
    0.05074382945895195,
    0.05735199153423309,
    0.06384121626615524,
    0.060371678322553635,
    0.04048514738678932,
    0.027498139068484306,
    0.0516338087618351,
    0.030921373516321182,
    0.05544506385922432,
    0.06268389523029327,
    0.03056848794221878,
    0.024221275001764297,
    0.050260428339242935,
    0.04492628201842308,
    0.025590242817997932,
    0.022533608600497246,
    0.03117469511926174,
    0.057183220982551575,
    0.09070819616317749,
    0.04683627560734749,
    0.03233958035707474,
    0.041207682341337204,
    0.14664681255817413,
    0.03334173560142517,
    0.052216537296772,
    0.051734644919633865,
    0.043982695788145065,
    0.07469570636749268,
    0.03583041578531265,
    0.05780372768640518,
    0.07327865064144135,
    0.037367966026067734,
    0.04037748649716377,
    0.06636085361242294,
    0.0496722012758255,
    0.03810305520892143,
    0.021608829498291016,
    0.09895849227905273,
    0.03718080744147301,
    0.03305334597826004,
    0.04297527298331261,
    0.04705356806516647,
    0.051215946674346924,
    0.0702892541885376,
    0.048993777483701706,
    0.0554874986410141,
    0.046238645911216736,
    0.02862711250782013,
    0.031774770468473434,
    0.059451330453157425,
    0.04925632104277611,
    0.036562658846378326,
    0.05396197736263275,
    0.081609345972538,
    0.08252950757741928,
    0.030326472595334053,
    0.04074221849441528,
    0.07722076028585434,
    0.030177265405654907,
    0.03743552044034004,
    0.045728377997875214,
    0.06090601906180382,
    0.03574218600988388,
    0.026133544743061066,
    0.02977285347878933,
    0.07049737870693207,
    0.06214408949017525,
    0.037702202796936035,
    0.05314123257994652,
    0.02792912907898426,
    0.024082418531179428,
    0.03556684032082558,
    0.041683949530124664,
    0.04808926209807396,
    0.03501233085989952,
    0.03641178458929062,
    0.046842172741889954,
    0.027473248541355133,
    0.039345622062683105,
    0.024514395743608475,
    0.024573687463998795,
    0.04194917157292366,
    0.07553745061159134,
    0.03655308112502098,
    0.03546420484781265,
    0.07239139825105667,
    0.05588727444410324,
    0.032828036695718765,
    0.02735890820622444,
    0.038237009197473526,
    0.07061832398176193,
    0.034921903163194656,
    0.06315351277589798,
    0.03598944842815399,
    0.056308332830667496,
    0.05311869457364082,
    0.029991617426276207,
    0.05044129490852356,
    0.05073753371834755,
    0.03416545316576958,
    0.04347310587763786,
    0.03740055486559868,
    0.04331560805439949,
    0.030628859996795654,
    0.02679341658949852,
    0.06285076588392258,
    0.031635645776987076,
    0.038473859429359436,
    0.04709398373961449,
    0.04330902919173241,
    0.051349200308322906,
    0.050056975334882736,
    0.037505168467760086,
    0.027379507198929787,
    0.042448852211236954,
    0.06799959391355515,
    0.042949602007865906,
    0.11340081691741943,
    0.046216391026973724,
    0.036082085222005844,
    0.04591786861419678,
    0.03718062490224838,
    0.044337112456560135,
    0.04051406681537628,
    0.05683569237589836,
    0.07297581434249878,
    0.04696753993630409,
    0.03954046219587326,
    0.048307571560144424,
    0.03513311222195625,
    0.04167700558900833,
    0.04327309876680374,
    0.04942867159843445,
    0.05823493003845215,
    0.058335140347480774,
    0.03543920814990997,
    0.03759705275297165,
    0.0846463143825531,
    0.03686095401644707,
    0.052540749311447144,
    0.033781811594963074,
    0.03459443151950836,
    0.04280570149421692,
    0.04891549423336983,
    0.09913647919893265,
    0.055888962000608444,
    0.02502409927546978,
    0.03742338716983795,
    0.04635019600391388,
    0.04498046636581421,
    0.039526961743831635,
    0.04141795262694359,
    0.04767028987407684,
    0.03711674362421036,
    0.03766423836350441,
    0.021341247484087944,
    0.061022672802209854,
    0.03410728648304939,
    0.03379083052277565,
    0.020128007978200912,
    0.04008731618523598,
    0.05178124085068703,
    0.02317015640437603,
    0.0674755647778511,
    0.03601989150047302,
    0.04028622806072235,
    0.026995424181222916,
    0.05668196082115173,
    0.03628918156027794,
    0.04328811541199684,
    0.037102337926626205,
    0.05293675512075424,
    0.0393766388297081,
    0.035168323665857315,
    0.05021807551383972,
    0.061504021286964417,
    0.05386494845151901,
    0.060717616230249405,
    0.04950563982129097,
    0.037810780107975006,
    0.034971028566360474,
    0.04270729795098305,
    0.058665987104177475,
    0.029107384383678436,
    0.03448006883263588,
    0.03635615110397339,
    0.03376428410410881,
    0.03045206144452095,
    0.04057377949357033,
    0.09023890644311905,
    0.06088143214583397,
    0.05829930678009987,
    0.04341341182589531,
    0.026163896545767784,
    0.02149926871061325,
    0.03356900066137314,
    0.05669878050684929,
    0.027164196595549583,
    0.049522992223501205,
    0.11790580302476883,
    0.04072537273168564,
    0.045370399951934814,
    0.07139109820127487,
    0.029607441276311874,
    0.06005041301250458,
    0.07308577001094818,
    0.04047927260398865,
    0.0481790192425251,
    0.04744061827659607,
    0.03161223977804184,
    0.07466006278991699,
    0.045023780316114426,
    0.05253303050994873,
    0.039920687675476074,
    0.039699703454971313,
    0.039086584001779556,
    0.035485997796058655,
    0.038949429988861084,
    0.036248430609703064,
    0.04737907648086548,
    0.04947219416499138,
    0.054195813834667206,
    0.03223216161131859,
    0.04326828569173813,
    0.059440162032842636,
    0.0427839420735836,
    0.050089769065380096,
    0.024120043963193893,
    0.03418711572885513,
    0.03105304017663002,
    0.02749156951904297,
    0.04518522694706917,
    0.04121765121817589,
    0.05192682519555092,
    0.046473316848278046,
    0.04040364921092987,
    0.024607568979263306,
    0.04444864019751549,
    0.03331183269619942,
    0.0452708974480629,
    0.04051513224840164,
    0.021497579291462898,
    0.03322185203433037,
    0.037738118320703506,
    0.04352167248725891,
    0.024845167994499207,
    0.046811483800411224,
    0.039667919278144836,
    0.04007280245423317,
    0.02390902489423752,
    0.03378063812851906,
    0.02880726382136345,
    0.05246230587363243,
    0.022005213424563408,
    0.07771286368370056,
    0.033291708678007126,
    0.056856099516153336,
    0.0449150986969471,
    0.019124818965792656,
    0.02693142369389534,
    0.03210592269897461,
    0.047850001603364944,
    0.04387971758842468,
    0.053716883063316345,
    0.04815244302153587,
    0.044380683451890945,
    0.043403178453445435,
    0.04383543133735657,
    0.03962872922420502,
    0.04853505641222,
    0.047783851623535156,
    0.0557158961892128,
    0.044477853924036026,
    0.08436604589223862,
    0.04496615007519722,
    0.04013068974018097,
    0.0283191055059433,
    0.04546231031417847,
    0.03579356148838997,
    0.05146460235118866,
    0.03525589779019356,
    0.07804515212774277,
    0.03476790338754654,
    0.0405036099255085,
    0.05410967022180557,
    0.02492520585656166,
    0.03630423545837402,
    0.048420730978250504,
    0.023549966514110565,
    0.03775440528988838,
    0.04055594652891159,
    0.047265734523534775,
    0.03321074694395065,
    0.039829086512327194,
    0.040581971406936646,
    0.0381777286529541,
    0.06574244052171707,
    0.019826103001832962,
    0.04828287661075592,
    0.030917447060346603,
    0.04135231673717499,
    0.04107941687107086,
    0.029038917273283005,
    0.05425947904586792,
    0.03324669599533081,
    0.03300075605511665,
    0.05491522699594498,
    0.0453767403960228,
    0.043178390711545944,
    0.029789820313453674,
    0.03151465579867363,
    0.054901253432035446,
    0.0645717903971672,
    0.04694565758109093,
    0.03675290569663048,
    0.05943669378757477,
    0.03690874204039574,
    0.047060154378414154,
    0.06135692447423935,
    0.026160722598433495,
    0.04173789173364639,
    0.04414590075612068,
    0.05024027079343796,
    0.04535459727048874,
    0.056613702327013016,
    0.04728343337774277,
    0.038829151540994644,
    0.043916746973991394,
    0.15825098752975464,
    0.028593791648745537,
    0.04735012724995613,
    0.029062820598483086,
    0.033509355038404465,
    0.05521804839372635,
    0.07942356914281845,
    0.03024834208190441,
    0.038190264254808426,
    0.03676450997591019,
    0.04302682355046272,
    0.05796797201037407,
    0.02865724265575409,
    0.04859074950218201,
    0.036287564784288406,
    0.0377078652381897,
    0.046353455632925034,
    0.04846423864364624,
    0.050338421016931534,
    0.043378718197345734,
    0.026608962565660477,
    0.033528853207826614,
    0.0707830935716629,
    0.04632284492254257,
    0.027890561148524284,
    0.03865388408303261,
    0.03256135806441307,
    0.04414568096399307,
    0.031980082392692566,
    0.05995163321495056,
    0.041880663484334946,
    0.020625459030270576,
    0.05999920144677162,
    0.05994005128741264,
    0.03542475402355194,
    0.023819971829652786,
    0.05437971279025078,
    0.034155022352933884,
    0.04448189213871956,
    0.03774670884013176,
    0.04694642871618271,
    0.03870324417948723,
    0.03432590514421463,
    0.06804640591144562,
    0.045439932495355606,
    0.0408385805785656,
    0.03529289737343788,
    0.03980215638875961,
    0.03747038170695305,
    0.049731478095054626,
    0.06279800832271576,
    0.06128765270113945,
    0.03580857440829277,
    0.05966641381382942,
    0.038148846477270126,
    0.05735676735639572,
    0.05923040583729744,
    0.03400859981775284,
    0.04534481093287468,
    0.04546080157160759,
    0.06193342059850693,
    0.03211580961942673,
    0.04007473215460777,
    0.06928183883428574,
    0.05057595297694206,
    0.04515167698264122,
    0.03771986439824104,
    0.03014358878135681,
    0.02473129890859127,
    0.03584350273013115,
    0.048644114285707474,
    0.048576001077890396,
    0.037431538105010986,
    0.031718697398900986,
    0.06778614223003387,
    0.03459056839346886,
    0.034184206277132034,
    0.033008743077516556,
    0.021595777943730354,
    0.0403241366147995,
    0.034487172961235046,
    0.030270613729953766,
    0.040863145142793655,
    0.02553216926753521,
    0.031169265508651733,
    0.036475662142038345,
    0.02067701332271099,
    0.0414719395339489,
    0.049893129616975784,
    0.03838074207305908,
    0.05978908762335777,
    0.035181354731321335,
    0.03907527029514313,
    0.03587610647082329,
    0.045547280460596085,
    0.04049450531601906,
    0.042266711592674255,
    0.05756020545959473,
    0.07099346071481705,
    0.05054892227053642,
    0.03247842565178871,
    0.04556382820010185,
    0.0457276776432991,
    0.055026426911354065,
    0.024657228961586952,
    0.03022594563663006,
    0.047680169343948364,
    0.03840310499072075,
    0.04706608131527901,
    0.05010371282696724,
    0.06756078451871872,
    0.05440320074558258,
    0.04165827855467796,
    0.06606614589691162,
    0.03144733980298042,
    0.022711360827088356,
    0.04142886400222778,
    0.06348271667957306,
    0.06061205640435219,
    0.03963349759578705,
    0.029393190518021584,
    0.0479312539100647,
    0.04485166817903519,
    0.04488745331764221,
    0.041499294340610504,
    0.041762858629226685,
    0.0502924770116806,
    0.03397027775645256,
    0.04144733399152756,
    0.050827670842409134,
    0.07500878721475601,
    0.13255302608013153,
    0.04671366140246391,
    0.033806659281253815,
    0.04241235926747322,
    0.0420207679271698,
    0.037257686257362366,
    0.057307224720716476,
    0.06788936257362366,
    0.08691048622131348,
    0.04103997349739075,
    0.03967871144413948,
    0.045368973165750504,
    0.0373520590364933,
    0.034947801381349564,
    0.03275151178240776,
    0.02739558182656765,
    0.03514399379491806,
    0.06010361388325691,
    0.07058361172676086,
    0.0350923128426075,
    0.06591431051492691,
    0.047655440866947174,
    0.04183841496706009,
    0.054347991943359375,
    0.030521973967552185,
    0.038187600672245026,
    0.051849693059921265,
    0.029091235250234604,
    0.040370989590883255,
    0.051890965551137924,
    0.037797022610902786,
    0.05457976087927818,
    0.027964266017079353,
    0.10279431939125061,
    0.045019567012786865,
    0.03750009089708328,
    0.07278937846422195,
    0.05350787192583084,
    0.05352210998535156,
    0.07887949049472809,
    0.032280538231134415,
    0.049994658678770065,
    0.04014132171869278,
    0.09094846993684769,
    0.06625264883041382,
    0.04764416441321373,
    0.033761054277420044,
    0.04638541862368584,
    0.032273877412080765,
    0.024624433368444443,
    0.04966292902827263,
    0.03620010241866112,
    0.03594314679503441,
    0.04923823103308678,
    0.04174879193305969,
    0.05215189978480339,
    0.04710797592997551,
    0.05740295723080635,
    0.10472218692302704,
    0.037434909492731094,
    0.055314358323812485,
    0.08048036694526672,
    0.06291535496711731,
    0.04379657655954361,
    0.046647004783153534,
    0.0636228621006012,
    0.047165460884571075,
    0.026876313611865044,
    0.045453596860170364,
    0.045733362436294556,
    0.04550381004810333,
    0.04448283463716507,
    0.049864210188388824,
    0.037931300699710846,
    0.06265610456466675,
    0.039187394082546234,
    0.030637143179774284,
    0.03798588365316391,
    0.02989053539931774,
    0.01902354508638382,
    0.054463908076286316,
    0.04379552602767944,
    0.034213948994874954,
    0.038765065371990204,
    0.033800557255744934,
    0.04701217636466026,
    0.04245857149362564,
    0.0906512662768364,
    0.04328610748052597,
    0.03850485756993294,
    0.06555180996656418,
    0.045747336000204086,
    0.046590957790613174,
    0.02169216424226761,
    0.04020674526691437,
    0.036340415477752686,
    0.059170208871364594,
    0.030054451897740364,
    0.027065616101026535,
    0.03665384650230408,
    0.038896311074495316,
    0.056973181664943695,
    0.07462368160486221,
    0.049142658710479736,
    0.03091515228152275,
    0.04910547286272049,
    0.04176522418856621,
    0.09422661364078522,
    0.051324065774679184,
    0.03901710361242294,
    0.09353520721197128,
    0.025127559900283813,
    0.03646452724933624,
    0.05547448620200157,
    0.043759725987911224,
    0.020498353987932205,
    0.08211998641490936,
    0.05346936732530594,
    0.030736872926354408,
    0.04702671617269516,
    0.038558218628168106,
    0.1396602839231491,
    0.07168422639369965,
    0.034235235303640366,
    0.04056839644908905,
    0.04888482391834259,
    0.03530150651931763,
    0.05067209526896477,
    0.052428238093853,
    0.031724248081445694,
    0.03257467970252037,
    0.0566747821867466,
    0.04917150363326073,
    0.04115172103047371,
    0.03718812018632889,
    0.0359371155500412,
    0.06694068014621735,
    0.034331489354372025,
    0.03778805583715439,
    0.043332550674676895,
    0.03244816139340401,
    0.04433624446392059,
    0.0196203775703907,
    0.03648050129413605,
    0.042971231043338776,
    0.061839282512664795,
    0.02662484720349312,
    0.03240794688463211,
    0.032537177205085754,
    0.04220820218324661,
    0.043926455080509186,
    0.04397508502006531,
    0.04047877714037895,
    0.044045064598321915,
    0.039080992341041565,
    0.04146110266447067,
    0.07500512152910233,
    0.030386725440621376,
    0.047134291380643845,
    0.042551081627607346,
    0.04117390513420105,
    0.03815707936882973,
    0.04284060001373291,
    0.03791240602731705,
    0.04714415222406387,
    0.044272176921367645,
    0.03460964933037758,
    0.03165804222226143,
    0.04716955125331879,
    0.040934327989816666,
    0.04521303251385689,
    0.058562785387039185,
    0.0521424263715744,
    0.04285421967506409,
    0.04896712675690651,
    0.07734677195549011,
    0.036227621138095856,
    0.04221152886748314,
    0.07305450737476349,
    0.0398893766105175,
    0.051489681005477905,
    0.09292804449796677,
    0.04051860421895981,
    0.051458939909935,
    0.026350488886237144,
    0.13604417443275452,
    0.03799588233232498,
    0.05302540957927704,
    0.054697178304195404,
    0.0576096847653389,
    0.05666208639740944,
    0.05196838453412056,
    0.06556770950555801,
    0.046083301305770874,
    0.04219922795891762,
    0.0540321059525013,
    0.09119223803281784,
    0.07481841742992401,
    0.03380992263555527,
    0.04048004746437073,
    0.04672009125351906,
    0.037157971411943436,
    0.045599356293678284,
    0.05433439835906029,
    0.07417897880077362,
    0.04458540305495262,
    0.04985979199409485,
    0.03155628219246864,
    0.020603470504283905,
    0.06653837114572525,
    0.04102424904704094,
    0.03655404597520828,
    0.04644368588924408,
    0.034014757722616196,
    0.11301314830780029,
    0.02623714506626129,
    0.028082339093089104,
    0.08458486199378967,
    0.0414399728178978,
    0.025668101385235786,
    0.04661097005009651,
    0.042621683329343796,
    0.08535467833280563,
    0.02330363728106022,
    0.024552717804908752,
    0.032765310257673264,
    0.03278311714529991,
    0.04649101570248604,
    0.027660440653562546,
    0.03721427172422409,
    0.043242596089839935,
    0.028917239978909492,
    0.08092840760946274,
    0.03950617462396622,
    0.035578373819589615,
    0.058041300624608994,
    0.023304199799895287,
    0.036006007343530655,
    0.02797321416437626,
    0.06048348918557167,
    0.03639524057507515,
    0.043779268860816956,
    0.06749236583709717,
    0.05613981559872627,
    0.06339725106954575,
    0.035133153200149536,
    0.038250748068094254,
    0.06556754559278488,
    0.022003503516316414,
    0.053244929760694504,
    0.04029243811964989,
    0.03518833592534065,
    0.055521078407764435,
    0.059121254831552505,
    0.06463446468114853,
    0.025745073333382607,
    0.02701260894536972,
    0.05073707923293114,
    0.060861002653837204,
    0.03851340338587761,
    0.09917978942394257,
    0.03631152957677841,
    0.046167194843292236,
    0.05381374433636665,
    0.03704375401139259,
    0.035892553627491,
    0.03769270330667496,
    0.10023622214794159,
    0.04646230861544609,
    0.07835014164447784,
    0.04231961816549301,
    0.03281526640057564,
    0.030150465667247772,
    0.032835543155670166,
    0.03867204114794731,
    0.047675494104623795,
    0.03552648052573204,
    0.024144824594259262,
    0.05600229278206825,
    0.032391127198934555,
    0.020769020542502403,
    0.04880620911717415,
    0.05635254085063934,
    0.040378719568252563,
    0.08660469204187393,
    0.05694565549492836,
    0.03740682452917099,
    0.03213785961270332,
    0.039484765380620956,
    0.06456112861633301,
    0.03626234829425812,
    0.03867220878601074,
    0.03836985304951668,
    0.03618917241692543,
    0.03757500275969505,
    0.05898064747452736,
    0.046264201402664185,
    0.04205789789557457,
    0.05721058323979378,
    0.042234212160110474,
    0.06548315286636353,
    0.0373920276761055,
    0.03611262887716293,
    0.03004966862499714,
    0.0568598173558712,
    0.10141097009181976,
    0.048032552003860474,
    0.03295445814728737,
    0.023657402023673058,
    0.0411529615521431,
    0.04286547005176544,
    0.03268728405237198,
    0.042349617928266525,
    0.046129606664180756,
    0.040457822382450104,
    0.05235236510634422,
    0.08489294350147247,
    0.030887635424733162,
    0.05024314299225807,
    0.04277423024177551,
    0.04223610833287239,
    0.0469248965382576,
    0.037754278630018234,
    0.044304925948381424,
    0.10728728771209717,
    0.03905944153666496,
    0.0323043055832386,
    0.04829094931483269,
    0.029693083837628365,
    0.06124110892415047,
    0.02916000597178936,
    0.0385858528316021,
    0.030125342309474945,
    0.04608258977532387,
    0.054984789341688156,
    0.04111694172024727,
    0.03483825922012329,
    0.034811560064554214,
    0.05188658460974693,
    0.0605987086892128,
    0.0642867311835289,
    0.031756941229104996,
    0.028346428647637367,
    0.04314880073070526,
    0.08206886798143387,
    0.033921048045158386,
    0.04963063448667526,
    0.03787361830472946,
    0.027110222727060318,
    0.0400664322078228,
    0.05473249405622482,
    0.04307902604341507,
    0.046553969383239746,
    0.05010753497481346,
    0.025069406256079674,
    0.059729043394327164,
    0.05750617757439613,
    0.07645969092845917,
    0.06433256715536118,
    0.07936897873878479,
    0.035015739500522614,
    0.03779160603880882,
    0.04438799247145653,
    0.05230414867401123,
    0.030982330441474915,
    0.03893935680389404,
    0.03677022457122803,
    0.056565288454294205,
    0.03843164071440697,
    0.057053469121456146,
    0.052123233675956726,
    0.05391222983598709,
    0.03101588413119316,
    0.03908361494541168,
    0.0510963536798954,
    0.051158275455236435,
    0.03206150606274605,
    0.0447084978222847,
    0.050215691328048706,
    0.058446530252695084,
    0.03750022128224373,
    0.03226584941148758,
    0.03738633170723915,
    0.05128050595521927,
    0.03780822455883026,
    0.030818702653050423,
    0.06911462545394897,
    0.06692720204591751,
    0.03625737503170967,
    0.034820180386304855,
    0.051216691732406616,
    0.03375081717967987,
    0.030368993058800697,
    0.04582388699054718,
    0.04435611888766289,
    0.060849495232105255,
    0.044027600437402725,
    0.04936382919549942,
    0.03364008292555809,
    0.0662117451429367,
    0.025487754493951797,
    0.06577038764953613,
    0.040213003754615784,
    0.030181942507624626,
    0.0398036390542984,
    0.02536897175014019,
    0.028803128749132156,
    0.049547698348760605,
    0.0559803806245327,
    0.029399700462818146,
    0.038871534168720245,
    0.028626279905438423,
    0.03966161236166954,
    0.05552767962217331,
    0.05430958420038223,
    0.042580556124448776,
    0.03614216670393944,
    0.048558928072452545,
    0.0443723201751709,
    0.03494386374950409,
    0.03425914794206619,
    0.03237668052315712,
    0.03803623095154762,
    0.04247148707509041,
    0.06935650110244751,
    0.037994105368852615,
    0.04041318967938423,
    0.03539777547121048,
    0.027616236358880997,
    0.04814591258764267,
    0.04295637458562851,
    0.044935379177331924,
    0.07608633488416672,
    0.05050777643918991,
    0.04653007537126541,
    0.04248831421136856,
    0.039442434906959534,
    0.02620828151702881,
    0.03483504801988602,
    0.07124584168195724,
    0.02317223511636257,
    0.03674008324742317,
    0.04955524206161499,
    0.04339270293712616,
    0.031815171241760254,
    0.03803769871592522,
    0.04132027551531792,
    0.039290159940719604,
    0.06350254267454147,
    0.05858773738145828,
    0.029187500476837158,
    0.03398289158940315,
    0.03608468547463417,
    0.054034821689128876,
    0.04012221470475197};

  nvinfer1::Weights kernel_scale_weight;
  kernel_scale_weight.type = nvinfer1::DataType::kFLOAT;
  kernel_scale_weight.values = static_cast<void*>(kernel_scale);
  kernel_scale_weight.count = n;
  nvinfer1::Dims kernel_scale_dims;
  kernel_scale_dims.nbDims = 1;
  kernel_scale_dims.d[0] = n;
  auto kernel_scale_tensor = trt_network->addConstant(kernel_scale_dims, kernel_scale_weight)->getOutput(0);
  auto* kernel_quant_layer = trt_network->addQuantize(*kernel_tensor, *kernel_scale_tensor);
  kernel_quant_layer->setAxis(1);
  auto kernel_quant_tensor =  kernel_quant_layer->getOutput(0);
  auto* kernel_dequant_layer = trt_network->addDequantize(*kernel_quant_tensor, *kernel_scale_tensor);
  kernel_dequant_layer->setAxis(1);
  auto kernel_dequant_tensor =  kernel_dequant_layer->getOutput(0);


nvinfer1::IOptimizationProfile* profile1 = trt_builder->createOptimizationProfile();
profile1->setDimensions("foo0", nvinfer1::OptProfileSelector::kMIN, nvinfer1::Dims2(1,1280));
profile1->setDimensions("foo0", nvinfer1::OptProfileSelector::kOPT, nvinfer1::Dims2(3,1280));
profile1->setDimensions("foo0", nvinfer1::OptProfileSelector::kMAX, nvinfer1::Dims2(128,1280));
trt_config->addOptimizationProfile(profile1);


  nvinfer1::Weights scale_weight;
  float scale_ptr[1] = {1.2756160497665 / 127.f};
  scale_weight.type = nvinfer1::DataType::kFLOAT;
  scale_weight.values = static_cast<void*>(scale_ptr);
  scale_weight.count = 1;
  nvinfer1::Dims scale_dims;
  scale_dims.nbDims = 1;
  scale_dims.d[0] = 1;
  auto* scale_tensor = trt_network->addConstant(scale_dims, scale_weight)->getOutput(0);



    auto* x = trt_network->getInput(0);
    auto* quant_layer = trt_network->addQuantize(*x, *scale_tensor);
    quant_layer->setAxis(1);
    x = quant_layer->getOutput(0);
    auto* dequant_layer = trt_network->addDequantize(*x, *scale_tensor);
    dequant_layer->setAxis(1);
    x = dequant_layer->getOutput(0);

    auto* matmul_layer = trt_network->addMatrixMultiply(*x, nvinfer1::MatrixOperation::kNONE,
                                                      *kernel_dequant_tensor, nvinfer1::MatrixOperation::kNONE);


    // auto* quant_layer1 = trt_network->addQuantize(*matmul_layer->getOutput(0), *scale_tensor);
    // quant_layer1->setAxis(1);
    // auto y = quant_layer1->getOutput(0);
    // auto* dequant_layer1 = trt_network->addDequantize(*y, *scale_tensor);
    // dequant_layer1->setAxis(1);
    // y = dequant_layer1->getOutput(0);
    // auto *act_tensor = trt_network->addActivation(*y, nvinfer1::ActivationType::kCLIP)->getOutput(0);
    
    //trt_network->markOutput(*act_tensor);
    trt_network->markOutput(*matmul_layer->getOutput(0));
    

    for (int i = 0 ; i < trt_network->getInput(0)->getDimensions().nbDims; i++) {
        std::cout << trt_network->getInput(0)->getDimensions().d[i] << std::endl;
    }

    std::cout << "构建engine完毕，输出 shape：" << std::endl;
    auto engine = trt_builder->buildEngineWithConfig(*trt_network, *trt_config);
    auto engine_out_dims = engine->getBindingDimensions(0);
    for (int i = 0 ; i < engine_out_dims.nbDims; i++)
    {
        std::cout << engine_out_dims.d[i] << std::endl;
    }
    
    auto execution_context = engine->createExecutionContext();





    nvinfer1::Dims runtime_input0_dims;
    runtime_input0_dims.nbDims = 2;
    runtime_input0_dims.d[0] = 1;
    runtime_input0_dims.d[1] = 1280;
    execution_context->setBindingDimensions(0, runtime_input0_dims);
    int runtime_input0_size = 1;
    for (int i = 0; i < runtime_input0_dims.nbDims; i++) runtime_input0_size *= runtime_input0_dims.d[i];

    auto runtime_result_dims = execution_context->getBindingDimensions(1);

    int runtime_result_size = 1;
    std::cout << "execution_context时的shape：" << std::endl;
    for (int i = 0 ; i < runtime_result_dims.nbDims; i++) {
        std::cout << runtime_result_dims.d[i] << std::endl;
        runtime_result_size *= runtime_result_dims.d[i];
    }

    std::vector<void*> device_ptrs(2, nullptr);
    float* runtime_input0_ptr = new float[runtime_input0_size];
    memset(runtime_input0_ptr, 0, sizeof(float) * runtime_input0_size);
    float* runtime_result_ptr = new float[runtime_result_size];

    for (int i = 0;i < runtime_input0_size; i++) runtime_input0_ptr[i] = 1.0;

    cudaMalloc( (void**)&device_ptrs[0], runtime_input0_size * sizeof(float) );
    cudaMalloc( (void**)&device_ptrs[1], runtime_result_size * sizeof(float) );
    cudaMemcpy(device_ptrs[0], runtime_input0_ptr, runtime_input0_size * sizeof(float), cudaMemcpyHostToDevice );

    cudaStream_t stream;
    cudaStreamCreate(&stream);    
    execution_context->enqueueV2(device_ptrs.data(), stream, nullptr);
    cudaDeviceSynchronize();
    std::cout << "runtime_input0_size" <<  runtime_input0_size <<  std::endl;
    std::cout << "result_size " << runtime_result_size   << std::endl;
    cudaMemcpy(runtime_result_ptr, device_ptrs[1], runtime_result_size  * sizeof(float), cudaMemcpyDeviceToHost );

    free(runtime_input0_ptr);
    free(runtime_result_ptr);

    cudaFree(device_ptrs[0]);
    cudaFree(device_ptrs[1]);
}
